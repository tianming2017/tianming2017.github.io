<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>做二休二排班计算器</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        text-align: center;
      }
      h1 {
        color: #333;
      }
      .container {
        background-color: #f5f5f5;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      input {
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin: 10px 0;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      button:hover {
        background-color: #45a049;
      }
      .result {
        margin-top: 20px;
        font-size: 18px;
        font-weight: bold;
        padding: 15px;
        border-radius: 5px;
      }
      .day-white {
        background-color: #ffeb3b;
        color: #000;
      }
      .day-night {
        background-color: #2196f3;
        color: white;
      }
      .day-off {
        background-color: #4caf50;
        color: white;
      }
      .settings {
        margin: 20px 0;
        padding: 15px;
        background-color: #e9e9e9;
        border-radius: 5px;
        text-align: left;
      }
      .update {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>做二休二排班计算器</h1>

      <div class="settings">
        <h3>基准设置</h3>
        <p>
          已知 <span id="baseDateDisplay">2025-05-27</span> 是
          <span id="baseDayTypeDisplay">白班</span>
        </p>
        <div>
          <label for="newBaseDate">修改基准日期:</label>
          <input type="date" id="newBaseDate" />
        </div>
        <div>
          <label for="newBaseDayType">当天班次:</label>
          <select id="newBaseDayType">
            <option value="白班">白班</option>
            <option value="晚班">晚班</option>
          </select>
        </div>
        <div class="update">
          <button onclick="updateBaseSettings()">更新基准</button>
        </div>
      </div>

      <h3>查询日期</h3>
      <input type="date" id="queryDate" />
      <button onclick="calculate()">查询班次</button>

      <div id="result" class="result"></div>
    </div>

    <script>
      // 基准日期和班次(存储在localStorage中)
      let baseDate = new Date('2025-05-28');
      let baseDayType = '晚班';

      // 初始化时从localStorage加载设置
      function loadSettings() {
        const savedBaseDate = localStorage.getItem('baseDate');
        const savedBaseDayType = localStorage.getItem('baseDayType');

        if (savedBaseDate) {
          baseDate = new Date(savedBaseDate);
          document.getElementById('newBaseDate').valueAsDate = baseDate;
        }

        if (savedBaseDayType) {
          baseDayType = savedBaseDayType;
          document.getElementById('newBaseDayType').value = baseDayType;
        }

        updateBaseDisplay();
      }

      // 更新基准显示
      function updateBaseDisplay() {
        document.getElementById('baseDateDisplay').textContent =
          formatDate(baseDate);
        document.getElementById('baseDayTypeDisplay').textContent = baseDayType;
      }

      // 更新基准设置
      function updateBaseSettings() {
        const newDateInput = document.getElementById('newBaseDate');
        const newDayTypeInput = document.getElementById('newBaseDayType');

        if (newDateInput.value) {
          baseDate = new Date(newDateInput.value);
          baseDayType = newDayTypeInput.value;

          // 保存到localStorage
          localStorage.setItem('baseDate', baseDate.toISOString());
          localStorage.setItem('baseDayType', baseDayType);

          updateBaseDisplay();
          alert('基准设置已更新！');
        } else {
          alert('请选择基准日期');
        }
      }

      // 计算班次
      function calculate() {
        const queryDateInput = document.getElementById('queryDate');
        const resultDiv = document.getElementById('result');

        if (!queryDateInput.value) {
          resultDiv.textContent = '请选择查询日期';
          resultDiv.className = 'result';
          return;
        }

        const targetDate = new Date(queryDateInput.value);
        const dayType = calculateDayType(targetDate);

        resultDiv.textContent = `${formatDate(targetDate)} 是 ${dayType}`;
        resultDiv.className = `result day-${getDayTypeClass(dayType)}`;
      }

      // 计算班次的核心算法
      function calculateDayType(targetDate) {
        // 计算两个日期之间的天数差
        const timeDiff = targetDate - baseDate;
        const dayDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

        // 计算在4天周期中的位置(0-3)
        const cyclePos = ((dayDiff % 4) + 4) % 4; // 处理负数情况

        // 根据基准班次和位置返回班次
        if (baseDayType === '白班') {
          switch (cyclePos) {
            case 0:
              return '白班';
            case 1:
              return '晚班';
            case 2:
              return '休息';
            case 3:
              return '休息';
            default:
              return '未知';
          }
        } else {
          // 基准是晚班的情况
          switch (cyclePos) {
            case 0:
              return '晚班';
            case 1:
              return '休息';
            case 2:
              return '休息';
            case 3:
              return '白班';
            default:
              return '未知';
          }
        }
      }

      // 辅助函数：格式化日期为YYYY-MM-DD
      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      // 获取班次对应的CSS类名
      function getDayTypeClass(dayType) {
        switch (dayType) {
          case '白班':
            return 'white';
          case '晚班':
            return 'night';
          case '休息':
            return 'off';
          default:
            return '';
        }
      }

      // 页面加载时初始化
      window.onload = function () {
        // 设置今天为默认查询日期
        document.getElementById('queryDate').valueAsDate = new Date();
        // 设置基准日期输入框的默认值为今天
        document.getElementById('newBaseDate').valueAsDate = new Date();
        // 加载设置
        loadSettings();
      };
    </script>
  </body>
</html>
